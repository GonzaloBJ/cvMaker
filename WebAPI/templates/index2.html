<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>API CVMaker</title>

  <style>
    :root {
      --bg:#0d1423;
      --card:#101a2d;
      --accent:#0ac4e8;
      --accent-hover:#06b1d0;
      --text:#e8f0fa;
      --muted:#9aa8c3;
      --input-bg:rgba(255,255,255,0.05);
      --input-border:rgba(255,255,255,0.08);
    }

    *{
      box-sizing:border-box;
      font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Arial;
    }

    body{
      margin:0;
      background:var(--bg);
      color:var(--text);
      padding:24px;
    }

    .wrap{
      max-width:1300px;
      margin:auto;
    }

    header h1{
      margin:0 0 30px 0;
      font-size:26px;
      font-weight:600;
      letter-spacing:-.5px;
    }

    .grid{
      display:grid;
      grid-template-columns: 1fr 1.2fr;
      gap:24px;
      align-items:flex-start;
    }

    .card{
      background:var(--card);
      padding:24px;
      border-radius:18px;
      box-shadow:0 8px 30px rgba(0,0,0,0.45);
      backdrop-filter:blur(6px);
    }

    h3{
      font-size:18px;
      margin:0 0 20px;
    }

    form{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(210px,1fr));
      gap:18px;
    }

    label{
      font-size:13px;
      color:var(--muted);
      margin-bottom:6px;
      display:block;
    }

    select{
      width:100%;
      padding:10px 12px;
      background:var(--input-bg);
      border:1px solid var(--input-border);
      border-radius:10px;
      color:var(--text);
      font-size:14px;
      outline:none;
      transition:border .2s;
    }
    select:hover, select:focus{
      border-color:var(--accent);
    }

    button{
      width:100%;
      padding:11px 12px;
      background:var(--accent);
      border:none;
      border-radius:10px;
      cursor:pointer;
      color:#00222a;
      font-weight:600;
      font-size:15px;
      letter-spacing:.3px;
      box-shadow:0 3px 10px rgba(0,0,0,0.4);
      transition:background .2s, transform .1s;
    }
    button:hover{ background:var(--accent-hover); }
    button:active{ transform:scale(.97); }

    .hint{
      font-size:13px;
      color:var(--muted);
      margin-top:10px;
    }

    #pdfSection{
      text-align:center;
    }

    #pdfViewer{
      width:100%;
      height:630px;
      border-radius:14px;
      border:none;
      background:#000;
    }

    @media(max-width:1000px){
      .grid{ grid-template-columns:1fr; }
      #pdfViewer{ height:520px; }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <h1>Shortcut API CVMaker</h1>
    </header>

    <div class="grid">

      <!-- PANEL DE CONFIGURACIÓN -->
      <section class="card">
        <h3>Generar CV Desde Archivo</h3>

        <form id="formAdd">
          <div>
            <label>Persona</label>
            <select id="person">
              <option value="gb">Gonzalo Barahona</option>
              <option value="gb_alt">Gonzalo Barahona (Alt)</option>
              <option value="fu">Fernanda Urrutia</option>
            </select>
          </div>

          <div>
            <label>Plantilla</label>
            <select id="template">
              <option value="basicATS">Basic ATS</option>
              <option value="fullATS">Full ATS</option>
              <option value="simpleA">Simple A</option>
              <option value="simpleACustom">Simple A (Custom)</option>
              <option value="doubleColumnA">Double Column A</option>
            </select>
          </div>

          <div>
            <label>Esquema de Color</label>
            <select id="color">
              <option value="lightBlue">Light Blue</option>
              <option value="darkRed">Dark Red</option>
            </select>
          </div>

          <div>
            <label>Idioma</label>
            <select id="lang">
              <option value="ESP">Español</option>
              <option value="ENG">English</option>
            </select>
          </div>

          <div>
            <button id="addBtn" type="submit">Generar CV</button>
          </div>
        </form>

        <div class="hint">
          Consejo: registra <strong>Arriendo</strong> y <strong>Pago Tarjeta de Crédito</strong> como gastos fijos al inicio del mes para cuadrar mejor ✔
        </div>
      </section>

      <!-- VISTA PREVIA PDF -->
      <section class="card" id="pdfSection" hidden>
        <h3>CV Generado</h3>
        <embed id="pdfViewer" type="application/pdf" src=""/>
      </section>

    </div>
  </div>

  <script>
    /* TU SCRIPT ORIGINAL, SIN MODIFICAR */
    document.getElementById('formAdd').addEventListener('submit', (ev)=>{
      ev.preventDefault();
      const template = document.getElementById('template').value;
      const lang = document.getElementById('lang').value;
      const person = document.getElementById('person').value;
      const color = document.getElementById('color').value;

      if(!template||!person) { 
        alert('Ingresa plantilla y persona'); 
        return 
      }

      const baseUrl = 'http://127.0.0.1:5000/cvMaker/cvDesdeArchivo';
      const params = new URLSearchParams();
      params.append('template', template);
      params.append('lang', lang);
      params.append('person', person);
      params.append('color', color);

      const url = `${baseUrl}?${params.toString()}`;

      fetch(url)
        .then(response => {
          if (!response.ok) throw new Error(response.status);
          return response.json();
        })
        .then(data => {
          const rutaPdf = data.file.toString()
            .replace('//','/').replace('//','/').replace('./','/');
          
          document.getElementById('pdfViewer').src = rutaPdf;
          document.getElementById('pdfSection').hidden = false;
        })
        .catch(error => console.error('Error fetching data:', error));
    });
  </script>

</body>
</html>
